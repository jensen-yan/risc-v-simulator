# 项目发展计划

## 当前能力概况
- 核心 ISA：支持 RV64I 基础指令集，兼容 RV32I，并实现常用的 M（乘除）与 C（压缩）扩展。
- CPU 形态：提供顺序（In-Order）与乱序（Out-of-Order）两套实现，包含寄存器重命名、ROB、保留站、Store Buffer 等组件。
- 调试与工具：CLI 参数支持精细调试预设、周期过滤，配套 DiffTest 框架、`run_tests.py` 批量测试脚本与覆盖率脚本。
- 质量保障：已有 GoogleTest 单元测试、riscv-tests 集成验证，以及较完整的架构/API 文档和任务清单。

## 短期目标（1–2 个月）
- 日志体系重构：按照 `task/log-refactor.md` 方案，统一 C++ 端与脚本端的日志格式、等级和输出介质。
- DiffTest 加强：补齐内存比对、异常路径对齐与报表输出，确保乱序核心在更多 riscv-tests 上有稳定基线。
- 工具改进：
  - `run_tests.py` 增加内存/超时等 CLI 参数，支持不同规模的回归测试。
  - `run_coverage.sh` 适配不同平台的并行检测与依赖校验。
- CI 与质量门槛：在本地或 CI 环境中串联构建、单测、riscv-tests 子集及覆盖率报告，形成可复用的检查流程。
- 文档同步：更新 README 与架构文档，反映最新功能与使用范例。

## 中期目标（3–6 个月）
- ISA 与架构演进：
  - 实现 A 扩展原子指令，完善 C 扩展缺失用例，评估 F/D 浮点扩展的实现成本。
  - 为分支预测、流水线阻塞等建立统一的性能计数接口，便于分析乱序核心瓶颈。
- 特权级与异常框架：
  - 引入关键 CSR（mstatus、mie、mtval 等）与异常编码，梳理 Trap/Exception 流程。
  - 建立机器模式下的异常向量与基本中断处理，为后续 MMU/操作系统铺路。
- 调试工具：
  - 输出结构化执行统计（JSON/CSV），便于脚本化分析。
  - 在 CLI 中加入默认示例或脚本化演示，降低使用门槛。

## 长期目标（6 个月以上）
- 系统级能力：
  - 实现基础 MMU/TLB 与分页机制，支持简单的虚拟内存场景。
  - 引入 L1 I/D Cache，并规划到 L2 的扩展接口，研究替换策略与命中率。
  - 模拟常见外设（UART、CLINT/PLIC），尝试引导轻量级 RTOS，逐步走向裁剪版 Linux。
- 性能与可视化：
  - 探索超标量/多发射、先进分支预测器与投机回滚机制。
  - 提供可视化或 GUI 工具，实时观察流水线、ROB、缓存状态。
  - 实现 GDB 远程调试协议，提升调试效率。

## 支撑工作与关注点
- 工具链与依赖：维持 riscv-tests 子模块同步，记录工具链版本，避免环境漂移。
- 测试矩阵：为每个阶段的目标定义可量化的验收标准（通过的测试集、覆盖率阈值、性能指标等）。
- 风险管控：大型特性（MMU、多级缓存等）需先完成原型验证，再逐步并入主线，避免一次性改动过大。
